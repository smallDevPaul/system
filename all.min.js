var system;Object.prototype.extend=function(t){for(p in t)this[p]=t[p];return this},Object.prototype.extend({is:function(){var t;return t=Object.prototype.toString.call(this),t=t.slice(8,t.length-1),0!==arguments.length?t===arguments[0]:t},hasProp:function(t){return t in this}}),system={canvas:{},world:{},event:{},init:function(t,e,n){return this.canvas=document.getElementById(t),this.world=this.canvas.getContext("2d"),e&&(this.canvas.width=e,this.canvas.height=n),this.width=this.canvas.width,this.height=this.canvas.height,this.world},fullWH:function(t){var e;e=function(){system.width=system.canvas.width=window.innerWidth,system.height=system.canvas.height=window.innerHeight},t&&t.is("Function")&&!arguments[1]?window.addEventListener("resize",function(n){e(),t(n)}):t||window.addEventListener("resize",e),e()},set:function(t){this.world.extend(t)},use:function(t,e){t.match(/key/gi)?window["on"+t]=e:this.canvas["on"+t]=e},unuse:function(t){this.use(t,null)},on:function(t,e,n){n=!!n,this.event.hasProp(t)||(this.event[t]=[]),this.event[t].push({handler:e,capture:n}),t.match(/key/gi)?window.addEventListener(t,e,n):this.canvas.addEventListener(t,e,n)},off:function(t,e){var n;null==e&&(e=0),n=this.event[t],t.match(/key/gi)?window.removeEventListener(t,n[e].handler,n[e].capture):this.canvas.removeEventListener(t,n[e].handler,n[e].capture),this.event[t].splice(e,1)},run:function(t){this.timer=setInterval(t)},clear:function(){system.world.clearRect(0,0,this.width,this.height)},stop:function(){clearInterval(this.timer,100/6)}};var Vector,Rectangle,Circle,Segment,Traingle,Polygon;Vector=function(t,e){this.x=t,this.y=e},Rectangle=function(t,e,i,n){if(this.vertex=[],arguments.length>4){var s=arguments;this.vertex[0]=new Vector(t,e),this.vertex[1]=new Vector(s[2],s[3]),this.vertex[2]=new Vector(s[4],s[5]),this.vertex[3]=new Vector(s[6],s[7])}else this.vertex[0]=new Vector(t,e),this.vertex[1]=new Vector(t,e+n),this.vertex[2]=new Vector(t+i,e+n),this.vertex[3]=new Vector(t+i,e)},Circle=function(t,e,i){this.c=new Vector(t,e),this.radius=i},Segment=function(t,e,i){this.point=[],arguments.length>3?(this.point[0]=new Vector(t,e),this.point[1]=new Vector(i,arguments[3])):(this.point[0]=new Vector(t,e),this.point[1]=new Vector(t+i,e))},Polygon=function(t){this.vertex=[];for(var e=0,i=0,n=t.length;n>i;e++,i+=2)this.vertex[e]=new Vector(t[i],t[i+1])},Vector.prototype.extend({distance_to:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},move:function(t,e){this.x+=t,this.y+=e},replace:function(t,e){this.x=t,this.y=e}}),Rectangle.prototype.extend({width:function(){return this.vertex[0].distance_to(this.vertex[3])},height:function(){return this.vertex[0].distance_to(this.vertex[1])},has_point:function(t){return this.vertex[0].x>t.x||this.vertex[0].y>t.y||this.vertex[2].x<t.x||this.vertex[2].y<t.y?!1:!0},move:function(t,e){for(var i=0;4>i;i++)this.vertex[i].move(t,e)},replace:function(t,e){this.move(t-this.vertex[0].x,e-this.vertex[0].y)},rect_collision:function(t){for(var e=0;4>e;e++)if(this.has_point(t.vertex[e]))return!0;for(var e=0;4>e;e++)if(t.has_point(this.vertex[e]))return!0;return!1},circle_collision:function(t){if(this.has_point(t.c))return!0;var e,i;if(i=!1,t.c.y<this.vertex[0].y)if(t.c.x<this.vertex[0].x)e=this.vertex[0];else if(t.c.x>this.vertex[3].x)e=this.vertex[3];else{if(t.c.y+t.radius>=this.vertex[0].y)return!0;i=!0}else if(t.c.y>this.vertex[1].y)if(t.c.x<this.vertex[1].x)e=this.vertex[1];else if(t.c.x>this.vertex[2].x)e=this.vertex[2];else{if(t.c.y-t.radius<=this.vertex[1].y)return!0;i=!0}else{if(i=!0,t.c.x<this.vertex[0].x&&t.c.x+t.radius>=this.vertex[0].x)return!0;if(t.c.x>this.vertex[2].x&&t.c.x-t.radius<=this.vertex[2].x)return!0}return i||e.distance_to(t.c)>t.radius?!1:!0}}),Segment.prototype.extend({length:function(){return this.point[0].distance_to(this.point[1])},move:function(t,e){this.point[0].move(t,e),this.point[1].move(t,e)},circle_collision:function(t){if(t.c.x>this.point[0].x&&t.c.x<this.point[1].x){var e,i,n,s;if(e=this.point[0].distance_to(t.c),i=this.point[1].distance_to(t.c),n=this.length(),s=(e+i+n)/2,2*Math.sqrt(s*(s-e)*(s-i)*(s-n))/n<=t.radius)return!0}else if(t.c.x>this.point[0].x){if(t.c.distance_to(this.point[1])<=t.radius)return!0}else if(t.c.distance_to(this.point[0])<=t.radius)return!0;return!1}}),Circle.prototype.extend({rect_collision:function(t){return t.circle_collision(this)},segment_collision:function(t){return t.circle_collision(this)},has_point:function(t){return t.distance_to(this.c)>this.radius?!1:!0},move:function(t,e){this.c.move(t,e)},replace:function(t,e){this.c.replace(t,e)}});system.brush={frect:function(t,e,i,s,n){var r=system.world;n&&(r.fillStyle=n),r.fillRect(t,e,i,s)},srect:function(t,e,i,s,n){var r=system.world;n&&(r.strokeStyle=n),r.strokeRect(t,e,i,s)},farc:function(t,e,i,s,n,r,o){var h=system.world;h.beginPath(),r&&(h.fillStyle=r),h.arc(t,e,i,s,n,!!o),h.fill(),h.closePath()},sarc:function(t,e,i,s,n,r,o){var h=system.world;h.beginPath(),r&&(h.strokeStyle=r),h.arc(t,e,i,s,n,!!o),h.stroke(),h.closePath()},fcircle:function(t,e,i,s){this.farc(t,e,i,0,2*Math.PI,s)},scircle:function(t,e,i,s){this.sarc(t,e,i,0,2*Math.PI,s)}},Rectangle.prototype.extend({style:function(t){this.hasProp("SO")||(this.SO={}),this.SO.extend(t)},fill:function(){var t=system.world;t.fillStyle=this.SO.fillStyle,t.fillRect(this.vertex[0].x,this.vertex[0].y,this.width(),this.height())},stroke:function(){var t=system.world;t.strokeStyle=this.SO.strokeStyle,t.strokeRect(this.vertex[0].x,this.vertex[0].y,this.width(),this.height())},draw:function(){var t=system.world,e=this.width(),i=this.height();t.extend(this.SO),t.fillRect(this.vertex[0].x,this.vertex[0].y,e,i),t.strokeRect(this.vertex[0].x,this.vertex[0].y,e,i)}}),Circle.prototype.style=Rectangle.prototype.style,Circle.prototype.extend({fill:function(){system.brush.fcircle(this.c.x,this.c.y,this.radius,this.SO.fillStyle)},stroke:function(){system.brush.scircle(this.c.x,this.c.y,this.radius,this.SO.strokeStyle)},draw:function(){var t=system.world;t.beginPath(),t.extned(this.SO),t.arc(this.c.x,this.c.y,this.radius,0,2*Math.PI,!1),t.fill(),t.stroke(),t.closePath()}}),Segment.prototype.extend({style:function(t){this.hasProp("SO")||(this.SO={}),this.SO.strokeStyle=t},draw:function(){var t=system.world;t.beginPath(),t.extend(this.SO),t.moveTo(this.point[0].x,this.point[0].y),t.lineTo(this.point[1].x,this.point[1].y),t.stroke(),t.closePath()}});var gravity,ginit;gravity={gdx:0,gdy:0,gmax:10,gstep:null,ginit:function(t,e){return this.gravitated=!0,this.gstep=new Vector(t,e),this},gset:function(t,e,i){return null!=i&&(this.gmax=i),this.gdx=t,this.gdy=e,this},gravitated:null,gravitate:function(){this.gravitated&&(Math.abs(this.gdx)<this.gmax&&(this.gdx+=this.gstep.x),Math.abs(this.gdy)<this.gmax&&(this.gdy+=this.gstep.y),this.move(this.gdx,this.gdy))},gzero:function(){this.gdx=0,this.gdy=0},gstop:function(){this.gravitated=!1}},ginit=function(t){t.is("Array")?t.map(function(t){t.prototype.extend(gravity)}):t.prototype.extend(gravity)};